Saya ulangi STEP-BY-STEP dari NOL untuk BIND9 DNS MASTER â†’ SLAVE yang benar & production-ready.

Contoh asumsi (silakan sesuaikan IP):

DNS-1 (MASTER) : 10.10.10.1
DNS-2 (SLAVE)  : 10.10.10.2
Domain         : srvlab.my.id
Reverse zone   : 10.10.10.0/24
OS             : Ubuntu / Debian (BIND9)

ğŸ§± STEP 0 â€” INSTALL BIND (DNS-1 & DNS-2)
apt update
apt install bind9 bind9utils bind9-dnsutils -y
systemctl enable bind9

ğŸ¥‡ STEP 1 â€” KONFIGURASI DNS-1 (MASTER)
1ï¸âƒ£ Buat ZONE FILE (FORWARD)
nano /etc/bind/db.srvlab.my.id

$TTL 300
@   IN SOA dns1.srvlab.my.id. admin.srvlab.my.id. (
        2025122901 ; serial (WAJIB naik tiap edit)
        3600       ; refresh
        900        ; retry
        604800     ; expire
        300        ; minimum
)

; NS
@       IN NS  dns1.srvlab.my.id.
@       IN NS  dns2.srvlab.my.id.

; A RECORD
dns1    IN A   10.10.10.1
dns2    IN A   10.10.10.2
cloud   IN A   10.10.10.50

2ï¸âƒ£ Buat ZONE FILE (REVERSE)
nano /etc/bind/db.10.10.10

$TTL 300
@   IN SOA dns1.srvlab.my.id. admin.srvlab.my.id. (
        2025122901
        3600
        900
        604800
        300
)

@       IN NS  dns1.srvlab.my.id.
@       IN NS  dns2.srvlab.my.id.

1       IN PTR dns1.srvlab.my.id.
2       IN PTR dns2.srvlab.my.id.
50      IN PTR cloud.srvlab.my.id.

3ï¸âƒ£ DAFTARKAN ZONE (DNS-1)
nano /etc/bind/named.conf.local

zone "srvlab.my.id" {
    type master;
    file "/etc/bind/db.srvlab.my.id";
    allow-transfer { 10.10.10.2; };
    also-notify { 10.10.10.2; };
};

zone "10.10.10.in-addr.arpa" {
    type master;
    file "/etc/bind/db.10.10.10";
    allow-transfer { 10.10.10.2; };
    also-notify { 10.10.10.2; };
};

4ï¸âƒ£ VALIDASI & RESTART (DNS-1)
named-checkzone srvlab.my.id /etc/bind/db.srvlab.my.id
named-checkzone 10.10.10.in-addr.arpa /etc/bind/db.10.10.10
systemctl restart bind9

ğŸ¥ˆ STEP 2 â€” KONFIGURASI DNS-2 (SLAVE)
1ï¸âƒ£ DAFTARKAN ZONE (SLAVE)
nano /etc/bind/named.conf.local

zone "srvlab.my.id" {
    type slave;
    masters { 10.10.10.1; };
    file "/etc/bind/slaves/db.srvlab.my.id";
};

zone "10.10.10.in-addr.arpa" {
    type slave;
    masters { 10.10.10.1; };
    file "/etc/bind/slaves/db.10.10.10";
};

2ï¸âƒ£ BUAT DIRECTORY SLAVE
mkdir -p /etc/bind/slaves
chown bind:bind /etc/bind/slaves

3ï¸âƒ£ RESTART DNS-2
systemctl restart bind9


ğŸ“Œ DNS-2 akan auto-sync dari DNS-1

ğŸ§ª STEP 3 â€” VERIFIKASI SYNC
Cek file di DNS-2:
ls -l /etc/bind/slaves/


Harus muncul:

db.srvlab.my.id
db.10.10.10

Cek serial sama:
dig @10.10.10.1 srvlab.my.id SOA
dig @10.10.10.2 srvlab.my.id SOA


âœ” Serial HARUS SAMA

ğŸ”„ STEP 4 â€” UPDATE ZONE (CONTOH)

Di DNS-1 saja:

app     IN A 10.10.10.60


â¬†ï¸ Naikkan serial

2025122902


Restart:

systemctl reload bind9


â¡ï¸ DNS-2 OTOMATIS UPDATE

ğŸš« LARANGAN KERAS

âŒ Edit zone di DNS-2
âŒ Copy manual db ke DNS-2
âŒ Serial tidak naik
âŒ Block TCP 53

ğŸ RINGKASAN FINAL

âœ” DNS-1 = MASTER
âœ” DNS-2 = SLAVE
âœ” Semua edit di DNS-1
âœ” Serial naik = auto sync
âœ” DNS-2 zero-touch

Kalau mau lanjut, saya bisa bantu:
1ï¸âƒ£ Split DNS internal vs public
2ï¸âƒ£ DNSSEC master-slave
3ï¸âƒ£ HA DNS (keepalived / anycast)
4ï¸âƒ£ Integrasi BIND + Cloudflare
5ï¸âƒ£ Monitoring DNS (alert kalau slave lag)

Tinggal bilang ğŸ‘













ğŸ¯ KONDISI AWAL (ASUMSI)

âœ… DNS MASTER sudah jalan

âœ… Zone sudah ada di MASTER

âœ… IP MASTER: 10.10.10.10

âœ… IP SLAVE: 10.20.20.10

âœ… Zone: srvlab.my.id

ğŸ¥‡ STEP 1 â€” INSTALL BIND9 DI SLAVE

Di container DNS SLAVE:

apt update
apt install bind9 bind9-utils -y

ğŸ¥‡ STEP 2 â€” KONFIGURASI ZONE SLAVE

Edit file:

nano /etc/bind/named.conf.local


Isi HANYA INI (jangan buat zone file manual):

zone "srvlab.my.id" {
    type slave;
    masters { 10.10.10.10; };
    file "/var/cache/bind/db.srvlab.my.id";
};


ğŸ“Œ JANGAN:

buat /etc/bind/zones/db.srvlab.my.id

edit zone di slave

ğŸ¥‡ STEP 3 â€” OPSIONAL (OPTIONS FILE)

Biasanya default cukup, tapi aman kalau dicek:

nano /etc/bind/named.conf.options


Pastikan ada:

options {
    directory "/var/cache/bind";
    recursion yes;
    allow-query { any; };
};

ğŸ¥‡ STEP 4 â€” FIREWALL (WAJIB)

Pastikan SLAVE bisa akses MASTER:

Port	Protocol
53	TCP & UDP

Jika ada firewall antar segmen â†’ WAJIB dibuka

ğŸ¥‡ STEP 5 â€” RESTART BIND SLAVE
systemctl restart bind9

ğŸ¥‡ STEP 6 â€” CEK SYNC (PALING PENTING)
1ï¸âƒ£ Lihat log
journalctl -u bind9 -n 50


Harus ada:

zone srvlab.my.id/IN: transferred serial XXXXX

2ï¸âƒ£ Cek file zone
ls -l /var/cache/bind/


Harus ada:

db.srvlab.my.id

ğŸ¥‡ STEP 7 â€” TEST QUERY

Dari SLAVE:

dig @10.20.20.10 ca01.srvlab.my.id


Bandingkan dengan MASTER:

dig @10.10.10.10 ca01.srvlab.my.id


âœ” Output HARUS sama

ğŸ” CARA SYNC SELANJUTNYA (OTOMATIS)

Setiap kali Anda:

Edit zone di MASTER

Naikkan serial number

Reload BIND MASTER

â¡ï¸ SLAVE AUTO UPDATE

Tidak perlu restart slave.

âš ï¸ KESALAHAN UMUM (HINDARI)

âŒ Serial tidak naik
âŒ Firewall TCP 53 ditutup
âŒ Dua master
âŒ Edit zone di slave
âŒ Salah IP master

ğŸ§  RINGKASAN FINAL

âœ” SLAVE tidak punya zone file sendiri
âœ” Sinkron AUTO via AXFR
âœ” Cukup 1 baris config
âœ” Beda segmen aman
âœ” Cocok productio


ğŸ¯ KASUS: BANYAK SUBDOMAIN + HA CLOUDFLARED

Contoh:

cloud.srvlab.my.id   â†’ Nextcloud
git.srvlab.my.id     â†’ Gitea
app.srvlab.my.id     â†’ Web internal
vpn.srvlab.my.id     â†’ Admin portal


Target:
âœ” Semua HA
âœ” Failover otomatis
âœ” Tidak ribet maintain

ğŸ§  PRINSIP DASAR (WAJIB DIPEGANG)
1ï¸âƒ£ Load Balancer bekerja per-hostname

Cloudflare TIDAK auto-failover semua subdomain dalam satu LB.

â¡ï¸ Setiap hostname punya kebijakan sendiri

2ï¸âƒ£ Cloudflared tunnel itu shared transport

Satu tunnel boleh handle banyak subdomain

3ï¸âƒ£ HA ideal =

Sedikit tunnel, banyak hostname

ğŸ† OPSI TERBAIK (REKOMENDASI)
ğŸ¥‡ OPSI A â€” 1 PASANG TUNNEL, BANYAK SUBDOMAIN (PALING IDEAL)
Arsitektur:
Tunnel-FE-1
Tunnel-FE-2
   |
   +-- cloud.srvlab.my.id
   +-- git.srvlab.my.id
   +-- app.srvlab.my.id

config.yml (di kedua frontend)
tunnel: tunnel-fe-1
credentials-file: /root/.cloudflared/tunnel-fe-1.json

ingress:
  - hostname: cloud.srvlab.my.id
    service: https://localhost:443
  - hostname: git.srvlab.my.id
    service: http://localhost:3000
  - hostname: app.srvlab.my.id
    service: http://localhost:8080
  - service: http_status:404


Frontend-2 SAMA, beda tunnel ID.

Load Balancer:

Buat 1 Load Balancer per subdomain

Subdomain	Pool
cloud.*	FE1 + FE2
git.*	FE1 + FE2
app.*	FE1 + FE2

âœ” Tunnel reuse
âœ” Failover presisi
âœ” Mudah maintain

ğŸ¥ˆ OPSI B â€” WILDCARD SUBDOMAIN (HEMAT WAKTU)
*.srvlab.my.id

Kelebihan:

âœ” Cepat
âœ” Satu LB
âœ” Sedikit klik

Kekurangan:

âŒ Semua service ikut failover bareng
âŒ Health check satu titik
âŒ Kurang granular

ğŸ“Œ Cocok:

Lab

Internal app

Homelab

ğŸ¥‰ OPSI C â€” TUNNEL PER SUBDOMAIN (TIDAK REKOMENDASI)
Tunnel-cloud
Tunnel-git
Tunnel-app


âŒ Ribet
âŒ Overkill
âŒ Susah maintain
âŒ Tidak scalable

ğŸ”‘ REKOMENDASI SAYA UNTUK ANDA

Melihat:
âœ” Banyak service (Nextcloud, DNS, WAF, Nginx)
âœ” LXD + container
âœ” Fokus learning + production

ğŸ‘‰ PAKAI OPSI A

ğŸ”§ CONTOH DETAIL LOAD BALANCER (cloud.srvlab.my.id)
Pool:

tunnel-fe-1

tunnel-fe-2

Health Check:
HTTPS
Path: /status.php
Interval: 60s
Timeout: 5s

ğŸ§ª FAILOVER MATRIX (BIAR JELAS)
Kondisi	Hasil
FE-1 mati	FE-2 aktif
FE-2 mati	FE-1 aktif
Backend mati	503
DNS mati	TIDAK PENGARUH
ğŸš« KESALAHAN UMUM

âŒ Satu tunnel per service
âŒ DNS round-robin
âŒ Health check /
âŒ SSL beda per frontend
âŒ Load balancer di Mikrotik (L7)

ğŸ RINGKASAN CEPAT

âœ” Banyak subdomain â†’ satu pasangan tunnel
âœ” Load balancer â†’ per subdomain
âœ” Failover â†’ Cloudflare
âœ” DNS internal â†’ tidak ikut HA
âœ” Ini arsitektur production-grade

Kalau mau lanjut, saya bisa bantu:
1ï¸âƒ£ Template config.yml final sesuai service Anda
2ï¸âƒ£ Naming convention tunnel & LB
3ï¸âƒ£ Cost Cloudflare Load Balancer (penting)
4ï¸âƒ£ Diagram ASCII final multi-subdomain
5ï¸âƒ£ Best practice health check tiap app

Tinggal bilang mau lanjut ke yang mana ğŸ‘